<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" type="image/png" href="/assets/images/imadmin.png" />
    <link rel="stylesheet" href="/import/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/import/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style_project.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="/import/sweetalert2/dist/sweetalert2.min.css">
    <link rel="stylesheet" type="text/css" href="/import/select2/dist/css/select2.min.css">
    <script src="/import/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/javascript/Admin_EditStudent.js"></script>
    <script>
        $(function () {
            $("#layout").load("/layouts/Admin_Layout.html");
        });
    </script>
    <title>Appointment</title>
    <style>
        input[type=text]:read-only {
            background: rgb(218, 218, 218);
        }

        .changePassword {
            display: none;
        }
    </style>
</head>

<body>
    <div id="layout"></div>
    <div class="content mb-5">
        <div class="row mt-3 mb-3">
            <div class="col-6">
                <p class="h2" style="margin: 0;" aria-hidden="true"><i class="fa fa-fw fa-users"></i> ข้อมูลนักศึกษา
                </p>
            </div>
            <div class="col-6">
                <p class="text-right" style="margin-bottom: 0px; margin-top: 8px;">ผู้ใช้งาน : Appointment Admin</p>
            </div>
            <hr width="100%">
        </div>
        <div class="row justify-content-center mb-5">
            <div class="col-12">
                <form style="border: 2px solid #ccc; padding: 50px;">
                    <div class="form-group col-6 offset-3 text-center">
                        <label class="h5" for="search_student_id" style="font-weight: bold;">ค้นหาข้อมูลนักศึกษา</label>
                        <input type="text" class="form-control input-padding" id="search_student_id"
                            style="text-align: center;" placeholder="รหัสนักศึกษา xxxxxxxxxxxx-x">
                    </div>
                    <div class="form-row mt-3 mb-5 justify-content-center">
                        <button type="button" class="btn btn-orange" id="btn_clear_search"
                            style="width: 150px">ล้างค้นหา</button>
                        <button type="button" class="btn btn-success" id="btn_search" style="width: 150px"><i
                                class="fa fa-fw fa-search"></i> ค้นหา</button>
                    </div>
                    <hr width="100%">
                    <div class="form-row mt-5" style="padding-left: 15px; padding-right: 15px;">
                        <div class="form-group col-2 text-right" style="padding-top: 12px;">
                            <label class="h5" for="tb_name_show" style="font-weight: bold;">ชื่อ-นามสกุล :
                            </label>
                        </div>
                        <div class="form-group col-8">
                            <input type="text" class="form-control input-padding" id="tb_name_show"
                                placeholder="ชื่อ-นามสกุล" readonly>
                        </div>
                    </div>
                    <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                        <div class="form-group col-2 text-right" style="padding-top: 12px;">
                            <label class="h5" for="tb_id_show" style="font-weight: bold;">รหัสนักศึกษา :
                            </label>
                        </div>
                        <div class="form-group col-8">
                            <input type="text" class="form-control input-padding" id="tb_id_show"
                                placeholder="รหัสนักศึกษา" readonly>
                        </div>
                    </div>
                    <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                        <div class="form-group col-2 text-right" style="padding-top: 12px;">
                            <label class="h5" for="tb_section_show" style="font-weight: bold;">กลุ่ม :
                            </label>
                        </div>
                        <div class="form-group col-8">
                            <input type="text" class="form-control input-padding" id="tb_section_show"
                                placeholder="กลุ่ม" readonly>
                        </div>
                    </div>
                    <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                        <div class="form-group col-2 text-right" style="padding-top: 12px;">
                            <label class="h5" for="tb_advisor_show" style="font-weight: bold;">อาจารย์ที่ปรึกษา :
                            </label>
                        </div>
                        <div class="form-group col-8">
                            <input type="text" class="form-control input-padding" id="tb_advisor_show"
                                placeholder="อาจารย์ที่ปรึกษา" readonly>
                        </div>
                    </div>
                    <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                        <div class="form-group col-2 text-right" style="padding-top: 12px;">
                            <label class="h5" for="tb_username_show" style="font-weight: bold;">ชื่อผู้ใช้ :
                            </label>
                        </div>
                        <div class="form-group col-8">
                            <input type="text" class="form-control input-padding" id="tb_username_show"
                                placeholder="ชื่อผู้ใช้" readonly>
                        </div>
                    </div>
                    <div class="form-row mb-3 justify-content-center">
                        <a class="h5" id="click_change_password"><i class="fa fa-fw fa-key"></i> เปลี่ยนรหัสผ่าน</a>
                    </div>
                    <div class="form-row mt-3 justify-content-center">
                        <button type="button" class="btn btn-danger" id="btn_delete" style="width: 150px"><i
                                class="fa fa-fw fa-bitbucket"></i> ลบ</button>
                        <button type="button" class="btn btn-orange" id="btn_insert" style="width: 150px"><i
                                class="fa fa-fw fa-plus"></i> เพิ่มข้อมูล</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="row">
            <div class="col-12 text-left mb-3">
                <p class="h2" style="margin: 0;" aria-hidden="true"><i class="fa fa-fw fa-list"></i>
                    รายการนัดหมายของนักศึกษา
                </p>
            </div>
            <div class="table-responsive mb-3" style="padding-left: 15px; padding-right: 15px;">
                <table id="table_show_appointment" class="table table-striped table-bordered dt-responsive nowrap"
                    style="width:100%">
                    <thead class="bg-success">
                        <tr>
                            <th class="headTable" style="text-align: center; width: 10%;">ลำดับ</th>
                            <th class="headTable" style="text-align: center; width: 25%;">หัวข้อ</th>
                            <th class="headTable" style="text-align: center; width: 25%;">ชื่ออาจารย์</th>
                            <th class="headTable" style="text-align: center; width: 20%;">สถานะการนัดหมาย</th>
                            <th class="headTable" style="text-align: center; width: 20%;">วันที่นัดหมาย</th>
                        </tr>
                    </thead>
                    <tbody name="table_show_appointment_tbody" style="text-align: center;">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="md_insert_user" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success" style="justify-content: center !important">
                    <h5 class="modal-title h5" style="font-weight: bold;" id="exampleModalLabel"><i
                            class="fa fa-fw fa-users"></i> เพิ่มข้อมูลนักศึกษา</h5>
                </div>
                <div class="modal-body">
                    <form style="border: 2px solid #ccc; padding: 50px;">
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_name" style="font-weight: bold;">ชื่อ-นามสกุล : </label>
                            </div>
                            <div class="form-group col-9">
                                <input type="text" class="form-control input-padding" id="tb_name"
                                    placeholder="ชื่อ-นามสกุล">
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_id" style="font-weight: bold;">รหัสนักศึกษา : </label>
                            </div>
                            <div class="form-group col-9">
                                <input type="text" class="form-control input-padding" id="tb_id"
                                    placeholder="รหัสนักศึกษา">
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px; height: 85px !important;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_section" style="font-weight: bold;">กลุ่ม : </label>
                            </div>
                            <div class="form-group col-9">
                                <select class="form-control input-padding js-example-basic-single" id="tb_section"
                                    style="height: 51.2px; width: 480px !important;">
                                    <option value="" selected disabled>กลุ่ม</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px; height: 85px !important;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="sl_teacher" style="font-weight: bold;">อาจารย์ที่ปรึกษา :
                                </label>
                            </div>
                            <div class="form-group col-9">
                                <select class="form-control input-padding js-example-basic-single" id="sl_teacher"
                                    style="height: 51.2px; width: 480px !important;">
                                    <option value="" selected disabled>อาจารย์ที่ปรึกษา</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_username" style="font-weight: bold;">ชื่อผู้ใช้ : </label>
                            </div>
                            <div class="form-group col-9">
                                <input type="text" class="form-control input-padding" id="tb_username"
                                    placeholder="ชื่อผู้ใช้" readonly>
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_password" style="font-weight: bold;">รหัสผ่าน : </label>
                            </div>
                            <div class="form-group col-9">
                                <input type="password" class="form-control input-padding" id="tb_password"
                                    placeholder="รหัสผ่าน">
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_confirm_password" style="font-weight: bold;">ยืนยันรหัสผ่าน :
                                </label>
                            </div>
                            <div class="form-group col-9">
                                <input type="password" class="form-control input-padding" id="tb_confirm_password"
                                    placeholder="ยืนยันรหัสผ่าน">
                            </div>
                        </div>
                        <div class="form-row mt-3 justify-content-center"
                            style="padding-left: 15px; padding-right: 15px;">
                            <button type="button" class="btn btn-orange" data-dismiss="modal"
                                style="width: 150px;">ยกเลิก</button>
                            <button type="button" class="btn btn-success" style="width: 150px;"
                                id="btn_submit_insert"><i class="fa fa-fw fa-floppy-o"></i> บันทึก</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="md_change_password" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success" style="justify-content: center !important;">
                    <h5 class="modal-title h5" style="font-weight: bold;" id="exampleModalLabel"><i
                            class="fa fa-fw fa-key"></i>
                        เปลี่ยนรหัสผ่าน</h5>
                </div>
                <div class="modal-body">
                    <form style="border: 2px solid #ccc; padding: 50px;">
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_old_password" style="font-weight: bold;">รหัสผ่านเดิม :
                                </label>
                            </div>
                            <div class="form-group col-8">
                                <input type="password" class="form-control input-padding" id="tb_old_password"
                                    placeholder="รหัสผ่านเดิม">
                            </div>
                        </div>
                        <div class="form-row" style="padding-left: 15px; padding-right: 15px;">
                            <div class="form-group col-3 text-right" style="padding-top: 12px;">
                                <label class="h5" for="tb_new_password" style="font-weight: bold;">รหัสผ่านใหม่ :
                                </label>
                            </div>
                            <div class="form-group col-8">
                                <input type="password" class="form-control input-padding" id="tb_new_password"
                                    placeholder="รหัสผ่านใหม่">
                                <div style="text-align: right;">
                                    <p>(อย่างน้อย 6 ตัวอักษร)</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-row justify-content-center">
                            <button type="button" class="btn btn-orange" style="width: 150px;"
                                data-dismiss="modal">ยกเลิก</button>
                            <button type="button" class="btn btn-success" style="width: 150px;"
                                id="btn_submit_change_password"><i class="fa fa-fw fa-floppy-o"></i>
                                บันทึก</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="loading_scn" style="display:none;">
        <img src="/assets/images/loading_screen.gif" />
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="/import/popper.js/dist/umd/popper.min.js"></script>
    <script src="/import/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/import/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="/import/select2/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/th.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.4.1/jquery.maskedinput.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-auth.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyAfi7-NAMGShglMviJTt58x-Lq0BzjDV04",
            authDomain: "appointment-c8cfd.firebaseapp.com",
            databaseURL: "https://appointment-c8cfd.firebaseio.com",
            projectId: "appointment-c8cfd",
            storageBucket: "appointment-c8cfd.appspot.com",
            messagingSenderId: "667228538540",
            appId: "1:667228538540:web:a20473d5c7b35eb9"
        };
        firebase.initializeApp(firebaseConfig);
    </script>

    <script>
        $(document).ready(function () {
            checkAuth();
            $('.js-example-basic-single').select2({
                language: {
                    noResults: function () {
                        return 'ไม่มีข้อมูล';
                    },
                },
            });
            $("#tb_id").mask("999999999999-9");
            $("#search_student_id").mask("999999999999-9");
        });

        var table = $('#table_show_appointment').DataTable({
            "language": {
                "lengthMenu": "แสดง _MENU_ รายการ",
                "zeroRecords": "ไม่มีรายการการนัดหมาย",
                "info": "รายการนัดหมายทั้งหมด _TOTAL_ รายการ",
                "infoEmpty": "ไม่มีรายการการนัดหมาย",
                "search": "ค้นหา",
                "infoFiltered": "(กรองจากทั้งหมด _MAX_ รายการ)",
                "paginate": {
                    "previous": "ย้อนกลับ",
                    "next": "ถัดไป",
                }
            }
        });
        $('#table_show_appointment tbody').on('click', 'td', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            var data = row.data();

            if (data != null) {
                var obj = {
                    "Topic": data["1"],
                    "Name": data["7"],
                    "Student_ID": data["6"],
                    "Teacher": data["2"],
                    "Day": data["11"],
                    "Date": data["8"],
                    "Time": data["9"],
                    "Detail": data["10"],
                    "Status": data["12"],
                    "Note_ID": data["5"],
                    "DeclineReason": data["13"],
                };
            }

            if (row.child.isShown()) {
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                if (obj != null) {
                    row.child(rowChild(obj)).show();
                    tr.addClass('shown');
                }
            }
        });

        var _checkQuery = 1;
        $('#btn_insert').on('click', function () {
            $("#md_insert_user").modal();
            if (_checkQuery === 1) {
                _checkQuery++;
                requestTeacher();
                setSection();
            }
        })

        $("#tb_id").keyup(function () {
            $("#tb_username").val($('#tb_id').val());
        });

        $('#btn_search').on('click', function () {
            submitSearch();
        });

        $('#btn_clear_search').on('click', function () {
            submitClearSearch();
        });

        $('#btn_submit_insert').on('click', function () {
            submitAddStudent();
        });

        $('#click_change_password').on('click', function () {
            $("#md_change_password").modal();
        });

        $('#btn_submit_change_password').on('click', function () {
            if ($('#tb_name_show').val()) {
                submitChangePassword();
            } else {
                Swal.fire({
                    type: 'error',
                    title: 'ERROR',
                    text: 'ไม่พบข้อมูลนักศึกษา !',
                    confirmButtonText: '<i class="fa fa-times"></i> ตกลง',
                })
            }
        });

        $('#btn_delete').on('click', function () {
            Swal.fire({
                title: 'WARNING',
                text: "ต้องการลบชื่อผู้ใช้งานนี้ ?",
                type: 'warning',
                showCancelButton: true,
                confirmButtonText: '<i class="fa fa-check"></i> ตกลง',
                cancelButtonText: '<i class="fa fa-times"></i> ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    submitDeleteData();
                }
            })
        });

    </script>
</body>

</html>