<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" type="image/png" href="/assets/images/imteacher.png" />
    <link rel="stylesheet" href="/import/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/import/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style_project.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="/import/sweetalert2/dist/sweetalert2.min.css">
    <script src="/import/jquery/dist/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script type="text/javascript" src="/javascript/Teacher_History.js"></script>
    <script>
        $(function () {
            $(".datepicker").datepicker({
                dateFormat: 'dd/mm/yy',
            }).datepicker("setDate", new Date()).trigger('change');
            $("#layout").load("/layouts/Teacher_Layout.html");
        });
    </script>
    <title>Appointment</title>
</head>

<body>
    <div id="layout"></div>
    <div class="content">
        <div class="row mt-3">
            <div class="col-6">
                <p class="h2" aria-hidden="true" id="text_history"><i class="fa fa-fw fa-file-text-o"></i>
                    ประวัติการนัดหมาย</p>
                <p class="h2" aria-hidden="true" id="text_report" style="display: none"><i
                        class="fa fa-fw fa-file-excel-o"></i>
                    รายงานการนัดหมาย</p>
            </div>
            <div class="col-6">
                <p class="text-right" style="margin-bottom: 0px; margin-top: 8px;">ผู้ใช้งาน : <span
                        id="user_login"></span></p>
            </div>
            <hr width="100%">
        </div>
        <div class="row mb-3">
            <div class="col-12 text-right">
                <a id="link_report" value=""><i class="fa fa-fw fa-file-excel-o"></i>
                    รายงานการนัดหมาย</a>
            </div>
        </div>
        <div class="row justify-content-center mt-5 mb-5" style="display: none" id="card_report">
            <div class="col-12">
                <div class="card mb-5">
                    <div class="card-body">
                        <div class="col-12">
                            <div class="row justify-content-center mt-3 mb-1">
                                <div class="input-group date" data-target-input="nearest" style="width: 25%;">
                                    <input type="text" class="form-control datetimepicker-input datepicker"
                                        id="startdate" placeholder="วันที่เริ่มต้น" style="text-align: center;"
                                        data-target="#startdate" />
                                    <div class="input-group-append" data-target="#startdate"
                                        data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span class="h5"
                                    style=" margin-bottom: 0px;margin-left: 20px;margin-right: 20px;margin-top: 20px;">
                                    ถึงวันที่ </span>
                                <div class="input-group date" data-target-input="nearest" style="width: 25%;">
                                    <input type="text" class="form-control datetimepicker-input datepicker" id="enddate"
                                        placeholder="วันที่สิ้นสุด" style="text-align: center;"
                                        data-target="#enddate" />
                                    <div class="input-group-append" data-target="#enddate" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-success"
                                    style="height:45px;margin-top: 5px;margin-bottom: 0px;margin-left: 20px;"
                                    id="btn_submit_report">
                                    <a aria-hidden="true"><i class="fa fa-fw fa-file-excel-o"></i> ตกลง</a></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive mb-3">
                    <table id="table_appointment_of_month"
                        class="table table-striped table-bordered dt-responsive nowrap" style="width:100%">
                        <thead class="bg-success">
                            <tr>
                                <th class="headTable" style="text-align: center; width: 10%;">ลำดับ</th>
                                <th class="headTable" style="text-align: center; width: 25%;">หัวข้อ</th>
                                <th class="headTable" style="text-align: center; width: 25%;">ชื่อ - นามสกุล</th>
                                <th class="headTable" style="text-align: center; width: 20%;">สถานะการนัดหมาย</th>
                                <th class="headTable" style="text-align: center; width: 20%;">วันที่นัดหมาย</th>
                            </tr>
                        </thead>
                        <tbody name="table_appointment_of_month_tbody" style="text-align: center;">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="table-responsive mb-3">
            <table id="table_show_appointment" class="table table-striped table-bordered dt-responsive nowrap"
                style="width:100%">
                <thead class="bg-success">
                    <tr>
                        <th class="headTable" style="text-align: center; width: 10%;">ลำดับ</th>
                        <th class="headTable" style="text-align: center; width: 25%;">หัวข้อ</th>
                        <th class="headTable" style="text-align: center; width: 25%;">ชื่อ - นามสกุล</th>
                        <th class="headTable" style="text-align: center; width: 20%;">สถานะการนัดหมาย</th>
                        <th class="headTable" style="text-align: center; width: 20%;">วันที่นัดหมาย</th>
                    </tr>
                </thead>
                <tbody name="table_show_appointment_tbody" style="text-align: center;">
                </tbody>
            </table>
        </div>
    </div>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="/import/popper.js/dist/umd/popper.min.js"></script>
    <script src="/import/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/import/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/th.js"></script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/exceljs@1.13.0/dist/exceljs.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-auth.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyAfi7-NAMGShglMviJTt58x-Lq0BzjDV04",
            authDomain: "appointment-c8cfd.firebaseapp.com",
            databaseURL: "https://appointment-c8cfd.firebaseio.com",
            projectId: "appointment-c8cfd",
            storageBucket: "appointment-c8cfd.appspot.com",
            messagingSenderId: "667228538540",
            appId: "1:667228538540:web:a20473d5c7b35eb9"
        };
        firebase.initializeApp(firebaseConfig);
    </script>

    <script>
        $(document).ready(function () {
            RequestAppointmentTeacher();
        });
        var table = $('#table_show_appointment').DataTable({
            "language": {
                "lengthMenu": "แสดง _MENU_ รายการ",
                "zeroRecords": "ไม่มีรายการการนัดหมาย",
                "info": "รายการนัดหมายทั้งหมด _TOTAL_ รายการ",
                "infoEmpty": "ไม่มีรายการการนัดหมาย",
                "search": "ค้นหา",
                "infoFiltered": "(กรองจากทั้งหมด _MAX_ รายการ)",
                "paginate": {
                    "previous": "ย้อนกลับ",
                    "next": "ถัดไป",
                }
            }
        });
        $('#table_show_appointment tbody').on('click', 'td', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            var data = row.data();

            if (data != null) {
                var obj = {
                    "Topic": data["1"],
                    "Name": data["2"],
                    "Student_ID": data["6"],
                    "Teacher": data["7"],
                    "Day": data["11"],
                    "Date": data["8"],
                    "Time": data["9"],
                    "Detail": data["10"],
                    "Status": data["12"],
                    "Note_ID": data["5"],
                    "DeclineReason": data["13"],
                    "Section": data["14"],
                    "Advisor": data["15"],
                };
            }

            if (row.child.isShown()) {
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                if (obj != null) {
                    row.child(rowChild(obj)).show();
                    tr.addClass('shown');
                }
            }
        });

        var tableofmonth = $('#table_appointment_of_month').DataTable({
            "language": {
                "lengthMenu": "แสดง _MENU_ รายการ",
                "zeroRecords": "ไม่มีรายการการนัดหมาย",
                "info": "รายการนัดหมายทั้งหมด _TOTAL_ รายการ",
                "infoEmpty": "ไม่มีรายการการนัดหมาย",
                "search": "ค้นหา",
                "infoFiltered": "(กรองจากทั้งหมด _MAX_ รายการ)",
                "paginate": {
                    "previous": "ย้อนกลับ",
                    "next": "ถัดไป",
                }
            }
        });
        $('#table_appointment_of_month tbody').on('click', 'td', function () {
            var tr = $(this).closest('tr');
            var row = tableofmonth.row(tr);

            var data = row.data();

            if (data != null) {
                var obj = {
                    "Topic": data["1"],
                    "Name": data["2"],
                    "Student_ID": data["6"],
                    "Teacher": data["7"],
                    "Day": data["11"],
                    "Date": data["8"],
                    "Time": data["9"],
                    "Detail": data["10"],
                    "Status": data["12"],
                    "Note_ID": data["5"],
                    "DeclineReason": data["13"],
                    "Section": data["14"],
                    "Advisor": data["15"],
                };
            }

            if (row.child.isShown()) {
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                if (obj != null) {
                    row.child(rowChild(obj)).show();
                    tr.addClass('shown');
                }
            }
        });

        $('#link_report').on('click', function () {
            tableofmonth.clear().draw();
            if ($(this).val() == "") {
                $('#table_show_appointment_wrapper').slideUp('slow');
                $('#text_history').slideUp('slow');
                $('#card_report').slideDown('slow');
                $('#text_report').slideDown('slow');
                $(this).html('' + '<i class="fa fa-fw fa-file-text-o"></i>' + ' ประวัติการนัดหมาย');
                $(this).val("true");
                var startdate = Date.parse($('#startdate').datepicker('getDate'));
                var enddate = Date.parse($('#enddate').datepicker('getDate')) + 86340000;
                RequestAppointmentReport(startdate, enddate);
            } else {
                $('#table_show_appointment_wrapper').slideDown('slow');
                $('#text_history').slideDown('slow');
                $('#card_report').slideUp('slow');
                $('#text_report').slideUp('slow');
                $(this).val("");
                $(this).html('' + '<i class="fa fa-fw fa-file-excel-o"></i>' + ' รายงานการนัดหมาย');
            }
        })

        $('#btn_submit_report').on('click', function () {
            var startdate = Date.parse($('#startdate').datepicker('getDate'));
            var enddate = Date.parse($('#enddate').datepicker('getDate')) + 86340000;
            exportReport(startdate, enddate, $('#startdate').datepicker('getDate').toString(), $('#enddate').datepicker('getDate').toString());
        })

        $('.datepicker').change(function () {
            if ($('#link_report').val() == "true") {
                var startdate = Date.parse($('#startdate').datepicker('getDate'));
                var enddate = Date.parse($('#enddate').datepicker('getDate')) + 86340000;
                RequestAppointmentReport(startdate, enddate);
            }
        })
    </script>
</body>

</html>